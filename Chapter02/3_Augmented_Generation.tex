\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
  
    \usepackage{datetime}
  
    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Keep aspect ratio if custom image width or height is specified
    \setkeys{Gin}{keepaspectratio}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{soul}      % strikethrough (\st) support for pandoc >= 3.0.0
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}


    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{RAG\_Rothman: Chapter 2 (c) Augmented Generation using Deeplake vector store}
    \date{\today\ at\ \currenttime} % Automatically include current date and time
    
    
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@ges}{\let\PY@bf=\textbf\let\PY@it=\textit}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \#Embedding-Based Retrieval with Deep Lake and OpenAI

Copyright 2024 Denis Rothman

    \section{1. Installing the
environment}\label{installing-the-environment}

    \emph{First run the following cells and restart Google Colab session if
prompted. Then run the notebook again cell by cell to explore the code.}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{30}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{deeplake}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{31}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{}The OpenAI Key}
\PY{k+kn}{import} \PY{n+nn}{os}
\PY{k+kn}{from} \PY{n+nn}{dotenv} \PY{k+kn}{import} \PY{n}{load\PYZus{}dotenv}
\PY{k+kn}{import} \PY{n+nn}{openai}

\PY{c+c1}{\PYZsh{} Load API Key}
\PY{n}{dotenv\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{D:/AdvancedR/knowbankedu/openai/.env}\PY{l+s+s1}{\PYZsq{}}
\PY{n}{load\PYZus{}dotenv}\PY{p}{(}\PY{n}{dotenv\PYZus{}path}\PY{p}{)}
\PY{c+c1}{\PYZsh{} OpenAI API Key}
\PY{n}{openai}\PY{o}{.}\PY{n}{api\PYZus{}key} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{getenv}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{OPENAI\PYZus{}API\PYZus{}KEY}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{ACTIVELOOP\PYZus{}TOKEN} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{getenv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ACTIVELOOP\PYZus{}TOKEN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \section{Retrieval Augmented
Generation}\label{retrieval-augmented-generation}

    \subsubsection{Initiating the query process by indicating location of
vector
store}\label{initiating-the-query-process-by-indicating-location-of-vector-store}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{32}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{vector\PYZus{}store\PYZus{}path} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{hub://zagamog/space\PYZus{}exploration\PYZus{}v1}\PY{l+s+s2}{\PYZdq{}}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{33}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{deeplake}\PY{n+nn}{.}\PY{n+nn}{core}\PY{n+nn}{.}\PY{n+nn}{vectorstore}\PY{n+nn}{.}\PY{n+nn}{deeplake\PYZus{}vectorstore} \PY{k+kn}{import} \PY{n}{VectorStore}
\PY{k+kn}{import} \PY{n+nn}{deeplake}\PY{n+nn}{.}\PY{n+nn}{util}
\PY{n}{ds} \PY{o}{=} \PY{n}{deeplake}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{vector\PYZus{}store\PYZus{}path}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
|5l\textbackslash{}|
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
This dataset can be visualized in Jupyter Notebook by ds.visualize() or at
https://app.activeloop.ai/zagamog/space\_exploration\_v1

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
-/
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
hub://zagamog/space\_exploration\_v1 loaded successfully.

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]

    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{34}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{vector\PYZus{}store} \PY{o}{=} \PY{n}{VectorStore}\PY{p}{(}\PY{n}{path}\PY{o}{=}\PY{n}{vector\PYZus{}store\PYZus{}path}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Deep Lake Dataset in hub://zagamog/space\_exploration\_v1 already exists, loading
from the storage
    \end{Verbatim}

    \subsection{Input and Query Retrieval}\label{input-and-query-retrieval}

    \subsection{Input}\label{input}

    \subsubsection{Retrieval query}\label{retrieval-query}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{35}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Print all tensors in the dataset}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Tensors in dataset:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n+nb}{list}\PY{p}{(}\PY{n}{ds}\PY{o}{.}\PY{n}{tensors}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Tensors in dataset: ['embedding\_tensor', 'id', 'metadata', 'text']
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{36}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{embedding\PYZus{}function}\PY{p}{(}\PY{n}{texts}\PY{p}{,} \PY{n}{model}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{text\PYZhy{}embedding\PYZhy{}3\PYZhy{}small}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{:}
   \PY{k}{if} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{texts}\PY{p}{,} \PY{n+nb}{str}\PY{p}{)}\PY{p}{:}
       \PY{n}{texts} \PY{o}{=} \PY{p}{[}\PY{n}{texts}\PY{p}{]}
   \PY{n}{texts} \PY{o}{=} \PY{p}{[}\PY{n}{t}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)} \PY{k}{for} \PY{n}{t} \PY{o+ow}{in} \PY{n}{texts}\PY{p}{]}
   \PY{k}{return} \PY{p}{[}\PY{n}{data}\PY{o}{.}\PY{n}{embedding} \PY{k}{for} \PY{n}{data} \PY{o+ow}{in} \PY{n}{openai}\PY{o}{.}\PY{n}{embeddings}\PY{o}{.}\PY{n}{create}\PY{p}{(}\PY{n+nb}{input} \PY{o}{=} \PY{n}{texts}\PY{p}{,} \PY{n}{model}\PY{o}{=}\PY{n}{model}\PY{p}{)}\PY{o}{.}\PY{n}{data}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{37}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{get\PYZus{}user\PYZus{}prompt}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} Request user input for the search prompt}
    \PY{k}{return} \PY{n+nb}{input}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Enter your search query: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{k}{def} \PY{n+nf}{search\PYZus{}query}\PY{p}{(}\PY{n}{prompt}\PY{p}{)}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} Assuming `vector\PYZus{}store` and `embedding\PYZus{}function` are already defined}
    \PY{n}{search\PYZus{}results} \PY{o}{=} \PY{n}{vector\PYZus{}store}\PY{o}{.}\PY{n}{search}\PY{p}{(}\PY{n}{embedding\PYZus{}data}\PY{o}{=}\PY{n}{prompt}\PY{p}{,} \PY{n}{embedding\PYZus{}function}\PY{o}{=}\PY{n}{embedding\PYZus{}function}\PY{p}{,} \PY{n}{embedding\PYZus{}tensor}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{embedding\PYZus{}tensor}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{k}{return} \PY{n}{search\PYZus{}results}

\PY{c+c1}{\PYZsh{} Get the user\PYZsq{}s search query}
\PY{c+c1}{\PYZsh{}user\PYZus{}prompt = get\PYZus{}user\PYZus{}prompt()}
\PY{c+c1}{\PYZsh{} or enter prompt if it is in a queue}
\PY{n}{user\PYZus{}prompt}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Tell me about space exploration on the Moon and Mars.}\PY{l+s+s2}{\PYZdq{}}

\PY{c+c1}{\PYZsh{} Perform the search}
\PY{n}{search\PYZus{}results} \PY{o}{=} \PY{n}{search\PYZus{}query}\PY{p}{(}\PY{n}{user\PYZus{}prompt}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Print the search results}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{search\PYZus{}results}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
\{'score': [0.5716322660446167, 0.5714114904403687, 0.5654380321502686,
0.561565637588501], 'id': ['chunk\_79', 'chunk\_121', 'chunk\_119', 'chunk\_42'],
'metadata': [\{'source': 'Source URL:
https://en.wikipedia.org/wiki/Exploration\_of\_Mars'\}, \{'source': ''\}, \{'source':
''\}, \{'source': 'Source URL:
https://en.wikipedia.org/wiki/Exploration\_of\_Mars'\}], 'text': ['udy of orbits to
land on Mars and return to Earth (High School level) Planetary Society Mars page
v t e Space exploration Benefits Future Topics Astronomy Deep space exploration
Space colonization Space research Spaceflight Human Uncrewed Exploration targets
Asteroids Comets Earth Moon Jupiter Mars Human mission Phobos Mercury Neptune
Pluto Saturn Uranus Venus History List of spaceflight records Timeline of Solar
System exploration Timeline of space exploration Space agencies CNSA CSA ESA
ISRO JAXA NASA Roscosmos UAESA Category Outline v t e Mars Outline of Mars
Geography Atmosphere Circulation Climate Dust devil tracks Methane Regions
Arabia Terra Cerberus (Mars) Cydonia Eridania Lake Iani Chaos Olympia Undae
Planum Australe Planum Boreum Quadrangles Sinus Meridiani Tempe Terra Terra
Cimmeria Terra Sabaea Tharsis Undae Ultimi Scopuli Vastitas Borealis Physical
features "Canals" ( list ) Canyons Catenae Chaos terrain Craters Fossae Gullies
Mensae Labyrinthi Mountains by height Observed', 'e choose to go to the Moon "
Apollo 8 Genesis reading Apollo 15 postal covers incident Space Mirror Memorial
The Astronaut Monument Lunar sample displays Moon rocks stolen or missing U.S.
Astronaut Hall of Fame Space program on U.S. stamps Apollo 17 Moon mice Moon
tree Other primates in space NASA International Space Apps Challenge Astronauts
Day National Astronaut Day Nikon NASA F4 Category Commons v t e Spacecraft
missions to Mars List of missions to Mars List of Mars orbiters List of
artificial objects on Mars Active Flybys Psyche ‡ (2023, flyby in 2026) Hera ‡
(2024, flyby in 2025) Europa Clipper ‡ (2024, flyby in 2025) Orbiters 2001 Mars
Odyssey Mars Express Mars Reconnaissance Orbiter timeline MAVEN ExoMars Trace
Gas Orbiter Hope Tianwen-1 orbiter Rovers Curiosity Mars Science Laboratory
timeline Perseverance Mars 2020 timeline Past Flybys Mars 1 † Mariner 4 Zond 2 †
Mariner 6 and 7 Mars 6 Mars 7 Rosetta ‡ Dawn ‡ Mars Cube One Orbiters Mars 2
Mars 3 Mariner 9 Mars 4 † Mars 5 Viki', 'Mars Exploration Mars Exploration Rover
Current Living With a Star Lunar Precursor Robotic Program Earth Observing
System Great Observatories program Explorers Voyager Discovery New Frontiers
Solar Terrestrial Probes Commercial Lunar Payload Services SIMPLEx Individual
featured missions (human and robotic) Past Apollo 11 COBE Mercury 3 Mercury-
Atlas 6 Magellan Pioneer 10 Pioneer 11 Galileo timeline GALEX GRAIL WMAP Space
Shuttle Spitzer Space Telescope Sojourner rover Spirit rover LADEE MESSENGER
Aquarius Cassini Dawn Kepler space telescope Opportunity rover timeline observed
RHESSI InSight Ingenuity helicopter flights Currently operating Mars
Reconnaissance Orbiter 2001 Mars Odyssey New Horizons International Space
Station Hubble Space Telescope Swift THEMIS Mars Exploration Rover Curiosity
rover timeline GOES 14 Lunar Reconnaissance Orbiter GOES 15 Van Allen Probes
Solar Dynamics Observatory Juno Mars Science Laboratory timeline NuSTAR Voyager
1 Voyager 2 WISE MAVEN MMS OSIRIS-REx Tr', 'ome of which are listed below. NASA
[ edit ] Human exploration by the United States was identified as a long-term
goal in the Vision for Space Exploration announced in 2004 by then US President
George W. Bush . [ 145 ] The planned Orion spacecraft would be used to send a
human expedition to Earth\textbackslash{}'s moon by 2020 as a stepping stone to a Mars
expedition. On September 28, 2007, NASA administrator Michael D. Griffin stated
that NASA aims to put a person on Mars by 2037. [ 146 ] On December 2, 2014,
NASA\textbackslash{}'s Advanced Human Exploration Systems and Operations Mission Director Jason
Crusan and Deputy Associate Administrator for Programs James Reuthner announced
tentative support for the Boeing "Affordable Mars Mission Design" including
radiation shielding, centrifugal artificial gravity, in-transit consumable
resupply, and a lander which can return. [ 147 ] [ 148 ] Reuthner suggested that
if adequate funding was forthcoming, the proposed mission would be expected in
the early 2030s. [ 149 ] Jour']\}
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{38}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{print}\PY{p}{(}\PY{n}{user\PYZus{}prompt}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Tell me about space exploration on the Moon and Mars.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{39}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Function to wrap text to a specified width}
\PY{k}{def} \PY{n+nf}{wrap\PYZus{}text}\PY{p}{(}\PY{n}{text}\PY{p}{,} \PY{n}{width}\PY{o}{=}\PY{l+m+mi}{80}\PY{p}{)}\PY{p}{:}
    \PY{n}{lines} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    \PY{k}{while} \PY{n+nb}{len}\PY{p}{(}\PY{n}{text}\PY{p}{)} \PY{o}{\PYZgt{}} \PY{n}{width}\PY{p}{:}
        \PY{n}{split\PYZus{}index} \PY{o}{=} \PY{n}{text}\PY{o}{.}\PY{n}{rfind}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{width}\PY{p}{)}
        \PY{k}{if} \PY{n}{split\PYZus{}index} \PY{o}{==} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}
            \PY{n}{split\PYZus{}index} \PY{o}{=} \PY{n}{width}
        \PY{n}{lines}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{text}\PY{p}{[}\PY{p}{:}\PY{n}{split\PYZus{}index}\PY{p}{]}\PY{p}{)}
        \PY{n}{text} \PY{o}{=} \PY{n}{text}\PY{p}{[}\PY{n}{split\PYZus{}index}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{strip}\PY{p}{(}\PY{p}{)}
    \PY{n}{lines}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{text}\PY{p}{)}
    \PY{k}{return} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{lines}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{40}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{textwrap}

\PY{c+c1}{\PYZsh{} Assuming the search results are ordered with the top result first}
\PY{n}{top\PYZus{}score} \PY{o}{=} \PY{n}{search\PYZus{}results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\PY{n}{top\PYZus{}text} \PY{o}{=} \PY{n}{search\PYZus{}results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{text}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{strip}\PY{p}{(}\PY{p}{)}
\PY{n}{top\PYZus{}metadata} \PY{o}{=} \PY{n}{search\PYZus{}results}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{metadata}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{source}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{c+c1}{\PYZsh{} Print the top search result}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Top Search Result:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Score: }\PY{l+s+si}{\PYZob{}}\PY{n}{top\PYZus{}score}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Source: }\PY{l+s+si}{\PYZob{}}\PY{n}{top\PYZus{}metadata}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Text:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{wrap\PYZus{}text}\PY{p}{(}\PY{n}{top\PYZus{}text}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Top Search Result:
Score: 0.5716322660446167
Source: Source URL: https://en.wikipedia.org/wiki/Exploration\_of\_Mars
Text:
udy of orbits to land on Mars and return to Earth (High School level) Planetary
Society Mars page v t e Space exploration Benefits Future Topics Astronomy Deep
space exploration Space colonization Space research Spaceflight Human Uncrewed
Exploration targets Asteroids Comets Earth Moon Jupiter Mars Human mission
Phobos Mercury Neptune Pluto Saturn Uranus Venus History List of spaceflight
records Timeline of Solar System exploration Timeline of space exploration
Space agencies CNSA CSA ESA ISRO JAXA NASA Roscosmos UAESA Category Outline v t
e Mars Outline of Mars Geography Atmosphere Circulation Climate Dust devil
tracks Methane Regions Arabia Terra Cerberus (Mars) Cydonia Eridania Lake Iani
Chaos Olympia Undae Planum Australe Planum Boreum Quadrangles Sinus Meridiani
Tempe Terra Terra Cimmeria Terra Sabaea Tharsis Undae Ultimi Scopuli Vastitas
Borealis Physical features "Canals" ( list ) Canyons Catenae Chaos terrain
Craters Fossae Gullies Mensae Labyrinthi Mountains by height Observed
    \end{Verbatim}

    \subsection{Augmented Input}\label{augmented-input}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{41}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{augmented\PYZus{}input}\PY{o}{=}\PY{n}{user\PYZus{}prompt}\PY{o}{+}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n}{top\PYZus{}text}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{42}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{print}\PY{p}{(}\PY{n}{augmented\PYZus{}input}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Tell me about space exploration on the Moon and Mars. udy of orbits to land on
Mars and return to Earth (High School level) Planetary Society Mars page v t e
Space exploration Benefits Future Topics Astronomy Deep space exploration Space
colonization Space research Spaceflight Human Uncrewed Exploration targets
Asteroids Comets Earth Moon Jupiter Mars Human mission Phobos Mercury Neptune
Pluto Saturn Uranus Venus History List of spaceflight records Timeline of Solar
System exploration Timeline of space exploration Space agencies CNSA CSA ESA
ISRO JAXA NASA Roscosmos UAESA Category Outline v t e Mars Outline of Mars
Geography Atmosphere Circulation Climate Dust devil tracks Methane Regions
Arabia Terra Cerberus (Mars) Cydonia Eridania Lake Iani Chaos Olympia Undae
Planum Australe Planum Boreum Quadrangles Sinus Meridiani Tempe Terra Terra
Cimmeria Terra Sabaea Tharsis Undae Ultimi Scopuli Vastitas Borealis Physical
features "Canals" ( list ) Canyons Catenae Chaos terrain Craters Fossae Gullies
Mensae Labyrinthi Mountains by height Observed
    \end{Verbatim}

    \section{Generation and output}\label{generation-and-output}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{43}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{openai}
\PY{k+kn}{from} \PY{n+nn}{openai} \PY{k+kn}{import} \PY{n}{OpenAI}
\PY{k+kn}{import} \PY{n+nn}{time}

\PY{n}{client} \PY{o}{=} \PY{n}{OpenAI}\PY{p}{(}\PY{p}{)}
\PY{n}{gpt\PYZus{}model}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gpt\PYZhy{}4o}\PY{l+s+s2}{\PYZdq{}}
\PY{n}{start\PYZus{}time} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Start timing before the request}

\PY{k}{def} \PY{n+nf}{call\PYZus{}gpt4\PYZus{}with\PYZus{}full\PYZus{}text}\PY{p}{(}\PY{n}{itext}\PY{p}{)}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} Join all lines to form a single string}
    \PY{n}{text\PYZus{}input} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{itext}\PY{p}{)}
    \PY{n}{prompt} \PY{o}{=} \PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Please summarize or elaborate on the following content:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+si}{\PYZob{}}\PY{n}{text\PYZus{}input}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}

    \PY{k}{try}\PY{p}{:}
        \PY{n}{response} \PY{o}{=} \PY{n}{client}\PY{o}{.}\PY{n}{chat}\PY{o}{.}\PY{n}{completions}\PY{o}{.}\PY{n}{create}\PY{p}{(}
            \PY{n}{model}\PY{o}{=}\PY{n}{gpt\PYZus{}model}\PY{p}{,}
            \PY{n}{messages}\PY{o}{=}\PY{p}{[}
                \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{role}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{system}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{content}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{You are a space exploration expert.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{\PYZcb{}}\PY{p}{,}
                \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{role}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{assistant}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{content}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{You can read the input and answer in detail.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{\PYZcb{}}\PY{p}{,}
                \PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{role}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{user}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{content}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{prompt}\PY{p}{\PYZcb{}}
            \PY{p}{]}\PY{p}{,}
            \PY{n}{temperature}\PY{o}{=}\PY{l+m+mf}{0.1}  \PY{c+c1}{\PYZsh{} Fine\PYZhy{}tune parameters as needed}
        \PY{p}{)}
        \PY{k}{return} \PY{n}{response}\PY{o}{.}\PY{n}{choices}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{message}\PY{o}{.}\PY{n}{content}
    \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
        \PY{k}{return} \PY{n+nb}{str}\PY{p}{(}\PY{n}{e}\PY{p}{)}

\PY{n}{gpt4\PYZus{}response} \PY{o}{=} \PY{n}{call\PYZus{}gpt4\PYZus{}with\PYZus{}full\PYZus{}text}\PY{p}{(}\PY{n}{augmented\PYZus{}input}\PY{p}{)}

\PY{n}{response\PYZus{}time} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{start\PYZus{}time}  \PY{c+c1}{\PYZsh{} Measure response time}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Response Time: }\PY{l+s+si}{\PYZob{}}\PY{n}{response\PYZus{}time}\PY{l+s+si}{:}\PY{l+s+s2}{.2f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{ seconds}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Print response time}

\PY{n+nb}{print}\PY{p}{(}\PY{n}{gpt\PYZus{}model}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Response:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{gpt4\PYZus{}response}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Response Time: 8.85 seconds
gpt-4o Response: Space exploration on the Moon and Mars has been a significant
focus of scientific and technological efforts, driven by the desire to
understand more about our solar system and the potential for human colonization
beyond Earth.

\#\#\# Moon Exploration
The Moon has been a primary target for space exploration due to its proximity to
Earth. Key milestones include:
- **Apollo Missions**: NASA's Apollo program successfully landed humans on the
Moon between 1969 and 1972, providing valuable data on lunar geology and the
potential for future human habitation.
- **Robotic Missions**: Various countries, including China, India, and Russia,
have sent robotic missions to the Moon to study its surface, search for water
ice, and test technologies for future human missions.

\#\#\# Mars Exploration
Mars has been a focal point for exploration due to its similarities to Earth and
the potential for past or present life. Key aspects include:
- **Robotic Missions**: NASA's rovers, such as Spirit, Opportunity, Curiosity,
and Perseverance, have explored Mars' surface, analyzing rocks, soil, and the
atmosphere to understand the planet's history and habitability.
- **Orbiters**: Satellites like the Mars Reconnaissance Orbiter and the European
Space Agency's Mars Express have provided detailed maps of the Martian surface
and climate data.
- **Human Missions**: Plans for human missions to Mars are being developed by
NASA and private companies like SpaceX, focusing on the challenges of long-
duration space travel and sustainable living on Mars.

\#\#\# Study of Orbits
Understanding the orbits necessary for landing on Mars and returning to Earth is
crucial for mission planning. This involves:
- **Hohmann Transfer Orbits**: A common method for traveling between planets,
minimizing fuel use by taking advantage of the relative positions of Earth and
Mars.
- **Aerobraking**: Using a planet's atmosphere to slow down a spacecraft,
reducing the need for fuel and allowing for more efficient landings.

\#\#\# Benefits of Space Exploration
Space exploration offers numerous benefits, including:
- **Scientific Knowledge**: Expanding our understanding of the solar system and
the potential for life beyond Earth.
- **Technological Advancements**: Innovations developed for space missions often
have applications on Earth, such as improvements in materials, communications,
and robotics.
- **Inspiration and Education**: Space exploration inspires future generations
and promotes interest in STEM fields.

\#\#\# Future Topics and Targets
Future exploration efforts will continue to focus on:
- **Deep Space Exploration**: Missions to asteroids, comets, and other planets
like Jupiter, Saturn, and beyond.
- **Space Colonization**: Developing the technology and infrastructure needed
for human settlements on the Moon and Mars.
- **Space Agencies**: Collaboration among international space agencies,
including NASA, ESA, CNSA, ISRO, JAXA, and others, to achieve common goals in
space exploration.

\#\#\# Mars Geography and Features
Mars is characterized by diverse geographical features, including:
- **Regions**: Areas like Arabia Terra, Cerberus, and Cydonia, each with unique
geological characteristics.
- **Physical Features**: Canyons, craters, and mountains, such as Olympus Mons,
the tallest volcano in the solar system.
- **Atmosphere and Climate**: Mars has a thin atmosphere, with dust storms and
evidence of past water flow, influencing its climate and potential habitability.

Overall, space exploration of the Moon and Mars continues to be a dynamic and
evolving field, with ongoing missions and future plans aimed at unlocking the
mysteries of our neighboring celestial bodies.
    \end{Verbatim}

    \subsubsection{Formatted response}\label{formatted-response}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{46}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{textwrap}
\PY{k+kn}{import} \PY{n+nn}{re}
\PY{k+kn}{from} \PY{n+nn}{IPython}\PY{n+nn}{.}\PY{n+nn}{display} \PY{k+kn}{import} \PY{n}{display}\PY{p}{,} \PY{n}{Markdown}\PY{p}{,} \PY{n}{HTML}
\PY{k+kn}{import} \PY{n+nn}{markdown}

\PY{k}{def} \PY{n+nf}{print\PYZus{}formatted\PYZus{}response}\PY{p}{(}\PY{n}{response}\PY{p}{)}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} Check for markdown by looking for patterns like headers, bold, lists, etc.}
    \PY{n}{markdown\PYZus{}patterns} \PY{o}{=} \PY{p}{[}
        \PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}\PYZsh{}+}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{s}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}           \PY{c+c1}{\PYZsh{} Headers}
        \PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{*+}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}            \PY{c+c1}{\PYZsh{} Bullet points}
        \PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{*}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{*}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}            \PY{c+c1}{\PYZsh{} Bold}
        \PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZus{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}               \PY{c+c1}{\PYZsh{} Italics}
        \PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{[.+}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{]}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{(.+}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{)}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}    \PY{c+c1}{\PYZsh{} Links}
        \PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{s}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}             \PY{c+c1}{\PYZsh{} Dashes used for lists}
        \PY{l+s+sa}{r}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{`}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{`}\PY{l+s+s2}{\PYZbs{}}\PY{l+s+s2}{`}\PY{l+s+s2}{\PYZdq{}}           \PY{c+c1}{\PYZsh{} Code blocks}
    \PY{p}{]}

    \PY{c+c1}{\PYZsh{} If any pattern matches, assume the response is in markdown}
    \PY{k}{if} \PY{n+nb}{any}\PY{p}{(}\PY{n}{re}\PY{o}{.}\PY{n}{search}\PY{p}{(}\PY{n}{pattern}\PY{p}{,} \PY{n}{response}\PY{p}{,} \PY{n}{re}\PY{o}{.}\PY{n}{MULTILINE}\PY{p}{)} \PY{k}{for} \PY{n}{pattern} \PY{o+ow}{in} \PY{n}{markdown\PYZus{}patterns}\PY{p}{)}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} Markdown detected, convert to HTML for nicer display}
        \PY{n}{html\PYZus{}output} \PY{o}{=} \PY{n}{markdown}\PY{o}{.}\PY{n}{markdown}\PY{p}{(}\PY{n}{response}\PY{p}{)}
        \PY{n}{display}\PY{p}{(}\PY{n}{HTML}\PY{p}{(}\PY{n}{html\PYZus{}output}\PY{p}{)}\PY{p}{)}  \PY{c+c1}{\PYZsh{} Use display(HTML()) to render HTML in Colab}
    \PY{k}{else}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} No markdown detected, wrap and print as plain text}
        \PY{n}{wrapper} \PY{o}{=} \PY{n}{textwrap}\PY{o}{.}\PY{n}{TextWrapper}\PY{p}{(}\PY{n}{width}\PY{o}{=}\PY{l+m+mi}{80}\PY{p}{)}
        \PY{n}{wrapped\PYZus{}text} \PY{o}{=} \PY{n}{wrapper}\PY{o}{.}\PY{n}{fill}\PY{p}{(}\PY{n}{text}\PY{o}{=}\PY{n}{response}\PY{p}{)}

        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Text Response:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{wrapped\PYZus{}text}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}\PYZhy{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{print\PYZus{}formatted\PYZus{}response}\PY{p}{(}\PY{n}{gpt4\PYZus{}response}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
<IPython.core.display.HTML object>
    \end{Verbatim}

    
    \section{Evaluating the output with Cosine
Similarity}\label{evaluating-the-output-with-cosine-similarity}

    with initial user prompt

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{47}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{feature\PYZus{}extraction}\PY{n+nn}{.}\PY{n+nn}{text} \PY{k+kn}{import} \PY{n}{TfidfVectorizer}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics}\PY{n+nn}{.}\PY{n+nn}{pairwise} \PY{k+kn}{import} \PY{n}{cosine\PYZus{}similarity}

\PY{k}{def} \PY{n+nf}{calculate\PYZus{}cosine\PYZus{}similarity}\PY{p}{(}\PY{n}{text1}\PY{p}{,} \PY{n}{text2}\PY{p}{)}\PY{p}{:}
    \PY{n}{vectorizer} \PY{o}{=} \PY{n}{TfidfVectorizer}\PY{p}{(}\PY{p}{)}
    \PY{n}{tfidf} \PY{o}{=} \PY{n}{vectorizer}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{p}{[}\PY{n}{text1}\PY{p}{,} \PY{n}{text2}\PY{p}{]}\PY{p}{)}
    \PY{n}{similarity} \PY{o}{=} \PY{n}{cosine\PYZus{}similarity}\PY{p}{(}\PY{n}{tfidf}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{tfidf}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}
    \PY{k}{return} \PY{n}{similarity}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}

\PY{n}{similarity\PYZus{}score} \PY{o}{=} \PY{n}{calculate\PYZus{}cosine\PYZus{}similarity}\PY{p}{(}\PY{n}{user\PYZus{}prompt}\PY{p}{,} \PY{n}{gpt4\PYZus{}response}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Cosine Similarity Score: }\PY{l+s+si}{\PYZob{}}\PY{n}{similarity\PYZus{}score}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Cosine Similarity Score: 0.470
    \end{Verbatim}

    with augmented user prompt

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{48}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{similarity\PYZus{}score} \PY{o}{=} \PY{n}{calculate\PYZus{}cosine\PYZus{}similarity}\PY{p}{(}\PY{n}{augmented\PYZus{}input}\PY{p}{,} \PY{n}{gpt4\PYZus{}response}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Cosine Similarity Score: }\PY{l+s+si}{\PYZob{}}\PY{n}{similarity\PYZus{}score}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Cosine Similarity Score: 0.418
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{50}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{sentence\PYZus{}transformers} \PY{k+kn}{import} \PY{n}{SentenceTransformer}
\PY{n}{model} \PY{o}{=} \PY{n}{SentenceTransformer}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{all\PYZhy{}MiniLM\PYZhy{}L6\PYZhy{}v2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
C:\textbackslash{}ProgramData\textbackslash{}anaconda3\textbackslash{}envs\textbackslash{}rothmanwa\textbackslash{}Lib\textbackslash{}site-packages\textbackslash{}tqdm\textbackslash{}auto.py:21:
TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See
https://ipywidgets.readthedocs.io/en/stable/user\_install.html
  from .autonotebook import tqdm as notebook\_tqdm
modules.json: 100\%|██████████| 349/349 [00:00<?, ?B/s]
config\_sentence\_transformers.json: 100\%|██████████| 116/116 [00:00<?, ?B/s]
README.md: 100\%|██████████| 10.7k/10.7k [00:00<?, ?B/s]
sentence\_bert\_config.json: 100\%|██████████| 53.0/53.0 [00:00<?, ?B/s]
config.json: 100\%|██████████| 612/612 [00:00<?, ?B/s]
model.safetensors: 100\%|██████████| 90.9M/90.9M [00:01<00:00, 55.1MB/s]
tokenizer\_config.json: 100\%|██████████| 350/350 [00:00<00:00, 348kB/s]
vocab.txt: 100\%|██████████| 232k/232k [00:00<00:00, 3.93MB/s]
tokenizer.json: 100\%|██████████| 466k/466k [00:00<00:00, 12.4MB/s]
special\_tokens\_map.json: 100\%|██████████| 112/112 [00:00<?, ?B/s]
1\_Pooling/config.json: 100\%|██████████| 190/190 [00:00<?, ?B/s]
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{51}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{calculate\PYZus{}cosine\PYZus{}similarity\PYZus{}with\PYZus{}embeddings}\PY{p}{(}\PY{n}{text1}\PY{p}{,} \PY{n}{text2}\PY{p}{)}\PY{p}{:}
    \PY{n}{embeddings1} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{encode}\PY{p}{(}\PY{n}{text1}\PY{p}{)}
    \PY{n}{embeddings2} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{encode}\PY{p}{(}\PY{n}{text2}\PY{p}{)}
    \PY{n}{similarity} \PY{o}{=} \PY{n}{cosine\PYZus{}similarity}\PY{p}{(}\PY{p}{[}\PY{n}{embeddings1}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{n}{embeddings2}\PY{p}{]}\PY{p}{)}
    \PY{k}{return} \PY{n}{similarity}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}


\PY{n}{similarity\PYZus{}score} \PY{o}{=} \PY{n}{calculate\PYZus{}cosine\PYZus{}similarity\PYZus{}with\PYZus{}embeddings}\PY{p}{(}\PY{n}{augmented\PYZus{}input}\PY{p}{,} \PY{n}{gpt4\PYZus{}response}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Cosine Similarity Score: }\PY{l+s+si}{\PYZob{}}\PY{n}{similarity\PYZus{}score}\PY{l+s+si}{:}\PY{l+s+s2}{.3f}\PY{l+s+si}{\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Cosine Similarity Score: 0.637
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}
\end{tcolorbox}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
